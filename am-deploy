#!/bin/bash

# AutoMinds "Wrap & Ship" CLI
# This tool simulates the packaging of the current workspace into a sovereign docker container.

echo -e "\033[1;34m::: AUTOMINDS STUDIOS :::\033[0m"
echo "Wrapping current workspace as a Sovereign Agent..."
echo "------------------------------------------------"

# 1. Validation
if [ ! -f "agent.py" ] && [ ! -f "main.py" ] && [ ! -f "package.json" ]; then
    echo -e "\033[1;31m[ERROR]\033[0m No entry point found (agent.py, main.py, or package.json)."
    echo "Please ensure you are in the root of your Agent project."
    exit 1
fi

echo -e "\033[1;32m[✓]\033[0m Entry point detected."

# 2. Dependency Scan
echo "Scanning dependencies..."
sleep 1
if [ -f "requirements.txt" ]; then
    DEP_COUNT=$(wc -l < requirements.txt)
    echo -e "\033[1;32m[✓]\033[0m Found Python dependencies ($DEP_COUNT items)."
elif [ -f "package.json" ]; then
    echo -e "\033[1;32m[✓]\033[0m Found Node.js dependencies."
else
    echo -e "\033[1;33m[!]\033[0m No dependency file found. Assuming standalone."
fi

# 3. Security (Simulation)
echo "Running Sentry Security Scan..."
sleep 2
echo -e "\033[1;32m[✓]\033[0m No hardcoded secrets found (Simulated)."

# 4. Build
echo "Building Container Image..."
for i in {1..5}; do
    echo -n "."
    sleep 0.5
done
echo ""
echo -e "\033[1;32m[✓]\033[0m Build Complete: registry.autominds.io/user-agent:v1.0.0"

# 5. Licensing
echo "Generating Commercial License Key..."
LICENSE_KEY="AM-$(openssl rand -hex 4 | tr '[:lower:]' '[:upper:]')-$(openssl rand -hex 4 | tr '[:lower:]' '[:upper:]')"
echo -e "\033[1;33m[LICENSE]\033[0m $LICENSE_KEY"

echo "------------------------------------------------"
echo -e "\033[1;34mReady to Ship.\033[0m"
echo "Your agent is ready for deployment to the client's air-gapped environment."
